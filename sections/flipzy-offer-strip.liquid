{% schema %}
{
  "name": "Flipzy Offer Strip",
  "class": "flipzy-section",
  "settings": [
    {
      "type": "header",
      "content": "Product & Offer"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Select Product",
      "info": "This determines the price and button action."
    },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "Background Color",
      "options": [
        { "value": "offer-scheme-cream", "label": "Cream (Warm)" },
        { "value": "offer-scheme-white", "label": "White (Clean)" },
        { "value": "offer-scheme-soft-blue", "label": "Soft Blue" }
      ],
      "default": "offer-scheme-cream"
    },
    {
      "type": "header",
      "content": "Text Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Special Offer – While Supplies Last"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "Don't miss this exclusive opportunity to transform your family's daily routines."
    },
    {
      "type": "text",
      "id": "shipping_text",
      "label": "Shipping Text",
      "default": "Delivery 1–2 days from London"
    },
    {
      "type": "text",
      "id": "guarantee_text",
      "label": "Guarantee Pill Text",
      "default": "✓ 30-day money-back guarantee • 24 months warranty"
    }
  ],
  "presets": [
    {
      "name": "Flipzy Offer Strip"
    }
  ]
}
{% endschema %}

{%- liquid
  assign product = section.settings.product
  assign current_variant = product.selected_or_first_available_variant
  assign compare_at_price = current_variant.compare_at_price
  assign price = current_variant.price
  assign money_price = price | money
  
  if compare_at_price > price
    assign saved_amount = compare_at_price | minus: price
    assign saved_percentage = saved_amount | times: 100.0 | divided_by: compare_at_price | round
  endif
-%}

<div class="flipzy-offer-section">
  <div class="flipzy-offer-container {{ section.settings.color_scheme }}">
    
    <h2 class="flipzy-offer-heading">{{ section.settings.heading }}</h2>
    
    <div class="flipzy-price-box">
      {% if product != blank %}
        {% if compare_at_price > price %}
          <span class="flipzy-price-compare">{{ compare_at_price | money }}</span>
        {% endif %}
        
        <span class="flipzy-price-current">{{ money_price }}</span>
        
        {% if compare_at_price > price %}
          <span class="flipzy-price-save-badge">-{{ saved_percentage }}%</span>
        {% endif %}
      {% else %}
        <span class="flipzy-price-compare">€44,00</span>
        <span class="flipzy-price-current">€35,90</span>
        <span class="flipzy-price-save-badge">-20%</span>
      {% endif %}
    </div>

    <div class="flipzy-offer-sub">{{ section.settings.subtitle }}</div>

    <div class="flipzy-shipping-text">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="1" y="3" width="15" height="13"></rect><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon><circle cx="5.5" cy="18.5" r="2.5"></circle><circle cx="18.5" cy="18.5" r="2.5"></circle></svg>
      {{ section.settings.shipping_text }}
    </div>

    {% if product != blank %}
      <product-form class="product-form">
        {%- form 'product', product, id: product_form_id, class: 'form', novalidate: 'novalidate', data-type: 'add-to-cart-form' -%}
          <input type="hidden" name="id" value="{{ current_variant.id }}">
          <button
            type="submit"
            name="add"
            class="flipzy-offer-btn"
            {% if current_variant.available == false %}disabled{% endif %}
          >
            {% if current_variant.available %}
              Add to cart – {{ money_price }}
            {% else %}
              Sold Out
            {% endif %}
          </button>
        {%- endform -%}
      </product-form>
    {% else %}
      <button class="flipzy-offer-btn">Add to cart – €35,90</button>
    {% endif %}

    <div class="flipzy-guarantee-pill">
      {{ section.settings.guarantee_text }}
    </div>

    <div class="flipzy-trust-footer">
      <div class="flipzy-trust-item">
        <svg class="flipzy-trust-icon" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
        <span>SSL Secure</span>
      </div>
      <div class="flipzy-trust-item">
        <svg class="flipzy-trust-icon" viewBox="0 0 24 24"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
        <span>Secure Payment</span>
      </div>
      <div class="flipzy-trust-item">
        <svg class="flipzy-trust-icon" viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
        <span>GDPR Compliant</span>
      </div>
    </div>

  </div>
</div>