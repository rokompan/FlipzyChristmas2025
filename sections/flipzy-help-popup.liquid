<div id="flipzy-help-popup-root">
  <button type="button" class="flipzy-help-button" id="flipzy-help-open">
    üí¨ Im√°m k√©rd√©st
  </button>

  <div class="flipzy-help-overlay" id="flipzy-help-overlay" aria-hidden="true">
    <div class="flipzy-help-modal">
      <button type="button" class="flipzy-help-close" id="flipzy-help-close">&times;</button>
      <h2 class="flipzy-help-title">Imate vpra≈°anje?</h2>
      <p class="flipzy-help-text">Napi≈°ite nam sporoƒçilo, odgovorili bomo na e-mail.</p>

      {% form 'contact', id: 'flipzy-help-form' %}
        <input type="hidden" name="form_type" value="contact">

        {%- comment -%}
          Skrit email za Shopify ‚Äì vedno veljaven,
          zato se kontakt forma vedno po≈°lje.
        {%- endcomment -%}
        <input type="hidden" name="contact[email]" value="{{ shop.email | default: shop.customer_email }}">

        <label class="flipzy-help-label">
          E-mail (neobvezno)
          <input type="text" name="contact[reply_email]" placeholder="Va≈° e-mail (ƒçe ≈æelite odgovor)">
        </label>

        <label class="flipzy-help-label">
          Va≈°e sporoƒçilo
          <textarea name="contact[body]" rows="4" required></textarea>
        </label>

        <button type="submit" class="flipzy-help-submit">Po≈°lji</button>
      {% endform %}
    </div>
  </div>
</div>

<style>
  .flipzy-help-button{
    position:fixed;
    right:20px;
    bottom:80px;
    z-index:9999;
    padding:10px 16px;
    border-radius:999px;
    border:none;
    background:#111827;
    color:#fff;
    font-size:14px;
    cursor:pointer;
    box-shadow:0 8px 20px rgba(0,0,0,.2);
  }
  .flipzy-help-overlay{
    position:fixed;
    inset:0;
    z-index:9998;
    background:rgba(15,23,42,.45);
    display:none;
    align-items:center;
    justify-content:center;
  }
  .flipzy-help-overlay.is-open{display:flex;}
  .flipzy-help-modal{
    width:100%;
    max-width:420px;
    background:#fff;
    border-radius:16px;
    padding:20px 20px 16px;
    box-shadow:0 18px 45px rgba(0,0,0,.25);
    position:relative;
  }
  .flipzy-help-close{
    position:absolute;
    top:8px;
    right:10px;
    border:none;
    background:transparent;
    font-size:20px;
    cursor:pointer;
  }
  .flipzy-help-title{
    margin:0 0 4px;
    font-size:18px;
    font-weight:600;
  }
  .flipzy-help-text{
    margin:0 0 12px;
    font-size:14px;
    color:#4b5563;
  }
  .flipzy-help-label{
    display:block;
    font-size:13px;
    margin-bottom:8px;
  }
  .flipzy-help-label input,
  .flipzy-help-label textarea{
    width:100%;
    margin-top:4px;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid #d1d5db;
    font-size:14px;
    resize:vertical;
  }
  .flipzy-help-submit{
    margin-top:8px;
    width:100%;
    padding:10px 14px;
    border-radius:999px;
    border:none;
    background:#22c55e;
    color:#fff;
    font-weight:600;
    cursor:pointer;
  }
  @media (max-width:768px){
    .flipzy-help-button{
      bottom:90px;
      right:16px;
    }
    .flipzy-help-modal{
      margin:0 16px;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function(){
    var openBtn = document.getElementById('flipzy-help-open');
    var overlay = document.getElementById('flipzy-help-overlay');
    var closeBtn = document.getElementById('flipzy-help-close');
    var form = document.getElementById('flipzy-help-form');
    var replyInput = document.querySelector('input[name="contact[reply_email]"]');
    var messageTextarea = document.querySelector('textarea[name="contact[body]"]');

    if(!openBtn || !overlay || !closeBtn) return;

    function openPopup(){
      overlay.classList.add('is-open');
      overlay.setAttribute('aria-hidden','false');
    }
    function closePopup(){
      overlay.classList.remove('is-open');
      overlay.setAttribute('aria-hidden','true');
    }

    openBtn.addEventListener('click', openPopup);
    closeBtn.addEventListener('click', closePopup);
    overlay.addEventListener('click', function(e){
      if(e.target === overlay) closePopup();
    });

    if (form && replyInput && messageTextarea) {
      form.addEventListener('submit', function () {
        var replyEmail = replyInput.value.trim();
        if (replyEmail) {
          messageTextarea.value =
            'Reply email: ' + replyEmail + '\n\n' + messageTextarea.value;
        }
      });
    }
  });
</script>
